<!DOCTYPE html>
<html lang="en">

<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <!-- Compiled and minified CSS -->
  <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/materialize/1.0.0/css/materialize.min.css">
  <link
    href="https://fonts.googleapis.com/css2?family=Economica:wght@700&family=Fontdiner+Swanky&family=Khand:wght@600&display=swap"
    rel="stylesheet">
  <link rel="stylesheet" href="style.css" class="css">
  <title>StreamJunkie</title>
</head>

<body>
  <section>
    <nav>
      <div class="nav-wrapper" style="background-color: darkred">
        <a href="./index.html" class="brand-logo center white-text" id="logo">StreamJunkie</a>
      </div>
    </nav>
  </section>
  <br>
  <br>
  <div class="container">

    <section class="hero" alt="StreamJunkie hero"></section>
    <div class="row" id="typeText">
      <div class="input-field col s5">
        <input type="text" id="autocomplete-input" class="autocomplete background-color white">
        <button class="btn waves-effect waves-light white-text" style="background-color: rgb(211, 22, 22)" type="submit"
          name="action">Search</button> <span id="m-or-t" class="right input-text"> Type Movie or TV Show</span>
      </div>
    </div>


    <div class="row">
      <div class="input-field col s12">
        <select name="genre_id" id="genre">
          <option value="" disabled selected>Choose your genre</option>
          <option value="28">Action🚔</option>
          <option value="12">Adventure🏞</option>
          <option value="16">Animation🤖</option>
          <option value="35">Comedy🤣</option>
          <option value="80">Crime🕵</option>
          <option value="99">Documentary🏛</option>
          <option value="18">Drama😓</option>
          <option value="10751">Family👨‍👧‍👦</option>
          <option value="14">Fantasy🧚‍♀️</option>
          <option value="36">History⏲</option>
          <option value="27">Horror😱</option>
          <option value="10402">Music🎵</option>
          <option value="9648">Mystery🤯</option>
          <option value="10749">Romance💘</option>
          <option value="878">Science Fiction👨‍🔬📰</option>
          <option value="53">Thriller😰</option>
          <option value="10752">War☠</option>
          <option value="37">Western🤠</option>
        </select>
      </div>

      <div class="input-field col s4">
        <input id="movie_name" type="text" class="validate">
        <label for="movie_name" id="relYear">Year</label>
        <button class="btn waves-effect waves-light white-text" style="background-color: rgb(211, 22, 22)" type="submit"
          name="action">Search</button>
      </div>
      <div class="col-6 border border- m-3 rounded">
        <span id="movie-name" class="movie-name font-weight-bold align-middle"></span>
        <p id="movieDetails"></p>
        <p id="movieReleaseDate"></p>
        <img id="current-pic" src="" alt="">
      </div>
    </div>
  </div>
  <footer class="footer-copyright center white-text" style="background-color: darkred;">
    © 2020 Copyright, inc.
  </footer>

  <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.2.1/jquery.min.js"></script>
  <script src="https://cdnjs.cloudflare.com/ajax/libs/materialize/1.0.0/js/materialize.min.js"></script>
  <script src="script.js"></script>
  <script>
     $("button").on('click', (evt) => {
        evt.preventDefault();
        let genreId = $("#genre").val();
        let movieYear = $("#movie_name").val();
        console.log(`Locals ${genreId} and ${movieYear}`);
        //Ajax
        var queryURL = "https://api.themoviedb.org/3/discover/movie/?with_genres=" + genreId + "&primary_release_year=" + movieYear + "&api_key=52cc32f4af978457c9927f10c080f307&language=en-US";
        $.ajax({
            url: queryURL,
            method: "GET",
            dataType: "jsonp"
        }).then(function (response) {
            console.log(`Response for movies ${JSON.stringify(response)}`);
            //storing the data from the ajax request in the genre variable
            console.log(response);
            let recArray = [];
            // array.filter(result => result.vote_average > 5)
            // Check for highly voted movies 

            // Loop over the movies with a vote average above 5
            for (let i = 0; response.results[i]; i++) {

                if (response.results[i].vote_average > 5) {
                    // Add the highly voted movies to an array
                    recArray.push(response.results[i])
                }
            }
            console.log(recArray);

            //Get recommended movie 
            let recommended = recArray[Math.floor(Math.random() * recArray.length)];
            console.log("The movie is: " + recommended.original_title)
            //Show the movie information on the page
            $("#movie-name").html("Movie Name: " + recommended.original_title);
            $("#movieDetails").html(recommended.overview);
            $("#movieReleaseDate").html(recommended.release_date);
            $("#current-pic").attr("src", "https://image.tmdb.org/t/p/w300_and_h450_bestv2" + recommended.poster_path)
        });
    })
  </script>
</body>

</html>